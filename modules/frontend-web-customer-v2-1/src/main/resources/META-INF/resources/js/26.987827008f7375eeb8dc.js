webpackJsonp([26],{211:function(t,e,s){var i=s(135)(s(531),s(543),null,null);t.exports=i.exports},531:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise__=__webpack_require__(139),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise__),__WEBPACK_IMPORTED_MODULE_1_jquery__=__webpack_require__(36),__WEBPACK_IMPORTED_MODULE_1_jquery___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_jquery__),__WEBPACK_IMPORTED_MODULE_2_toastr__=__webpack_require__(140),__WEBPACK_IMPORTED_MODULE_2_toastr___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_toastr__);__webpack_exports__.default={data:function(){return{dossierTemplateItems:[],dossierMarksItems:[],dossierFilesItems:[],thongTinHoSo:{},valid:!0,stateView:!1,dialogAddOtherTemp:!1,loadingAddOther:!1,otherDossierTemplate:"",sheet:!1,partView:"",fileViews:[{dossierFileId:12121,displayName:"THanh phan 1"},{dossierFileId:12122,displayName:"THanh phan 2"}]}},computed:{loading:function(){return this.$store.getters.loading}},mounted:function(){var t=this;t.page=1,t.$nextTick(function(){})},methods:{resetCounterTemplate:function(t,e){t.commit,t.state;this.dossierTemplateItems.forEach(function(t){t.partNo===e.partNo&&(t.hasForm?t.count=1:t.count=0)})},recountFileTemplates:function(){var t=this;t.dossierTemplateItems.forEach(function(e){e.count=0,t.dossierFilesItems.forEach(function(t){e.partNo===t.dossierPartNo&&e.count++})})},initData:function(t){var e=this,s=[];console.log("dossierId++++++++",t.dossierId),s.push(e.$store.dispatch("loadDossierTemplates",t)),s.push(e.$store.dispatch("loadDossierMark",t)),s.push(e.$store.dispatch("loadDossierFiles",t.dossierId)),e.thongTinHoSo=t,__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_promise___default.a.all(s).then(function(t){var s=t[0],i=t[1],a=t[2];console.log("dossierTemplates++++++",s),console.log("dossierMarks++++++",i),console.log("dossierFiles++++++",a);var o=e.mergeDossierTemplateVsDossierFiles(s,a);console.log("dossierTemplateItems++++++MERGER++++file",o),o=e.mergeDossierTemplateVsDossierMark(o,i),console.log("dossierTemplateItems++++++MERGE++++mark",o),e.dossierTemplateItems=o,e.dossierFilesItems=a,e.dossierMarksItems=i,setTimeout(function(t){e.genAllAlpacaForm(a,o),e.recountFileTemplates()},500),console.log("dossierTemplateItems",e.dossierTemplateItems)}).catch(function(t){})},genAllAlpacaForm:function(t,e){var s=this;if(t.length>0){var i=t.filter(function(t){return t.eForm}),a=e.filter(function(t){return t.hasForm&&1===t.partType});i.length>0?i.forEach(function(t){t.eForm&&s.$store.dispatch("loadAlpcaForm",t)}):e.forEach(function(t){t.hasForm&&1===t.partType&&(t.templateFileNo=s.thongTinHoSo.dossierTemplateNo,s.showAlpacaJSFORM(t))}),a.length!==i.length&&a.forEach(function(t){-1===i.findIndex(function(e){return t.partNo===e.dossierPartNo})&&(t.templateFileNo=s.thongTinHoSo.dossierTemplateNo,s.showAlpacaJSFORM(t))})}else e.forEach(function(t){t.hasForm&&1===t.partType&&(t.templateFileNo=s.thongTinHoSo.dossierTemplateNo,s.showAlpacaJSFORM(t))})},postDossierMark:function(t,e){var s=this;t.dossierId=s.thongTinHoSo.dossierId,s.$store.dispatch("postDossierMark",t).then(function(t){}).catch(function(t){})},mergeDossierTemplateVsDossierFiles:function(t,e){return e?t.forEach(function(t){var s=e.find(function(e){return t.partNo===e.dossierPartNo&&0===t.partType&&t.hasForm});s?t.daKhai=!0:!s&&t.hasForm&&(t.daKhai=!1)}):t.forEach(function(t){t.hasForm&&(t.daKhai=!1)}),t},mergeDossierTemplateVsDossierMark:function(t,e){return t=e?t.map(function(t){return t.count=0,e.forEach(function(e,s){e.dossierPartNo===t.partNo&&(t.fileType=e.fileType)}),t}):t.map(function(t){return t.count=0,t.fileType=0,t})},showAlpacaJSFORM:function showAlpacaJSFORM(item){var vm=this;vm.$store.dispatch("loadFormScript",item).then(function(resScript){vm.$store.dispatch("loadFormData",item).then(function(resData){var formScript,formData;formScript=resScript?eval("("+resScript+")"):{},formData=resData?eval("("+resData+")"):{},formScript.data=formData,__WEBPACK_IMPORTED_MODULE_1_jquery___default()("#formAlpaca"+item.partNo).alpaca(formScript)})})},saveAlpacaForm:function(t,e){var s=this,i=s.dossierFilesItems.find(function(e){return e.dossierPartNo===t.partNo});i?(i.dossierId=s.thongTinHoSo.dossierId,s.$store.dispatch("putAlpacaForm",i).then(function(t){__WEBPACK_IMPORTED_MODULE_2_toastr___default.a.success("Yêu cầu của bạn được thực hiện thành công.")}).catch(function(t){__WEBPACK_IMPORTED_MODULE_2_toastr___default.a.error("Yêu cầu của bạn được thực hiện thất bại.")})):(t.dossierId=s.thongTinHoSo.dossierId,s.$store.dispatch("postEform",t).then(function(t){__WEBPACK_IMPORTED_MODULE_2_toastr___default.a.success("Yêu cầu của bạn được thực hiện thành công."),s.$store.dispatch("loadDossierFiles",s.thongTinHoSo.dossierId).then(function(t){s.dossierFilesItems=t}).catch(function(t){__WEBPACK_IMPORTED_MODULE_2_toastr___default.a.error("Yêu cầu của bạn được thực hiện thất bại.")})})),s.dossierTemplateItems[e].daKhai=!0},onDeleteAttackFiles:function(t){var e=this;console.log("delete"),confirm("Bạn có muốn xóa toàn bộ file trong thành phần hồ sơ này?")&&e.dossierFilesItems.forEach(function(s){s.dossierPartNo===t.partNo&&(s.dossierId=e.thongTinHoSo.dossierId,e.$store.dispatch("deleteAttackFiles",s).then(function(s){e.resetCounterTemplate(t),e.$store.dispatch("loadDossierFiles",e.thongTinHoSo.dossierId)}).catch(function(t){}))})},pickFile:function(t){document.getElementById("file"+t.partNo).click()},onUploadSingleFile:function(t,e){var s=this;t.dataItem=e,t.dossierId=s.thongTinHoSo.dossierId,t.dossierTemplateNo=s.thongTinHoSo.dossierTemplateNo,s.$store.dispatch("uploadSingleFile",t).then(function(t){s.$store.dispatch("loadDossierFiles",s.thongTinHoSo.dossierId).then(function(t){s.dossierFilesItems=t,s.recountFileTemplates()})}).catch(function(t){})},loadAlpcaForm:function(t){var e=this,s=e.dossierFilesItems.find(function(e){return e.dossierPartNo===t.partNo&&e.eForm});s?e.$store.dispatch("loadAlpcaForm",s):e.dossierTemplateItems.forEach(function(s){s.hasForm&&t.partNo===s.partNo&&(s.templateFileNo=e.thongTinHoSo.dossierTemplateNo,e.showAlpacaJSFORM(s))})},deleteSingleFileEform:function(t,e){var s=this;confirm("Bạn có muốn xóa?")&&(s.dossierFilesItems.forEach(function(e){e.dossierPartNo===t.partNo&&e.eForm&&s.$store.dispatch("deleteDossierFile",e).then(function(e){console.log("success!"),s.$store.dispatch("loadDossierFiles",s.thongTinHoSo.dossierId).then(function(e){s.dossierFilesItems=e,s.recountFileTemplates();var i=s.dossierFilesItems.filter(function(e){return e.dossierPartNo===t.partNo});i&&(s.fileViews=i)})})}),s.dossierTemplateItems[e].daKhai=!1)},deleteSingleFile:function(t,e){var s=this;confirm("Bạn có muốn xóa?")&&s.$store.dispatch("deleteDossierFile",t).then(function(e){__WEBPACK_IMPORTED_MODULE_2_toastr___default.a.success("Yêu cầu của bạn được thực hiện thành công."),s.$store.dispatch("loadDossierFiles",s.thongTinHoSo.dossierId).then(function(e){s.dossierFilesItems=e,s.recountFileTemplates();var i=s.dossierFilesItems.filter(function(e){return e.dossierPartNo===t.partNo});i&&(s.fileViews=i)})}).catch(function(t){__WEBPACK_IMPORTED_MODULE_2_toastr___default.a.error("Yêu cầu của bạn được thực hiện thất bại.")})},viewFile:function(t){var e=this,s=this;s.dossierFilesItems.forEach(function(i){i.dossierId=s.thongTinHoSo.dossierId,i.dossierPartNo===t.partNo&&e.$store.dispatch("viewFile",i)})},viewFile2:function(t){var e=this;t.dossierId=e.thongTinHoSo.dossierId,e.$store.dispatch("viewFile",t)},viewFileWithPartNo:function(t){var e=this;if(e.dossierFilesItems){var s=e.dossierFilesItems.filter(function(e){return e.dossierPartNo===t.partNo});if(!s)return;e.fileViews=s,e.partView=t.partNo,e.stateView=!e.stateView}},changeOtherDossierTemp:function(t){var e=this;e.loadingAddOther=!0,e.$store.dispatch("uploadSingleOtherFile",{dossierId:e.thongTinHoSo.dossierId,displayName:t}).then(function(t){e.loadingAddOther=!1,e.dialogAddOtherTemp=!1}).catch(function(t){e.loadingAddOther=!1})},addOtherTemplate:function(){var t=this;t.$refs.form.validate()&&t.changeOtherDossierTemp(t.otherDossierTemplate)}}}},543:function(t,e){t.exports={render:function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",[s("v-card",[t._l(t.dossierTemplateItems,function(e,i){return 1===e.partType?s("div",{key:e.partNo,staticClass:"form_alpaca",staticStyle:{position:"relative"}},[s("v-expansion-panel",{staticClass:"expaned__list__data",class:{no_acction__event:!e.hasForm}},[s("v-expansion-panel-content",{attrs:{"hide-actions":"",value:!1}},[s("div",{attrs:{slot:"header"},on:{click:function(e){t.stateView=!1}},slot:"header"},[s("div",{staticStyle:{width:"calc(100% - 370px)",display:"flex","align-items":"center","min-height":"38px",background:"#fff","padding-left":"15px"}},[s("span",{staticClass:"text-bold mr-2"},[t._v(t._s(i+1)+".")]),t._v(" "),s("span",{on:{click:function(s){t.loadAlpcaForm(e)}}},[t._v(t._s(e.partName)+" "),e.required?s("span",{staticStyle:{color:"red"}},[t._v(" (*)")]):t._e(),t._v(" "),e.hasForm?s("i",{staticStyle:{"font-size":"10px",color:"#0d71bb"}},[t._v("(Form trực tuyến)")]):t._e(),t._v(" "),e.hasForm?s("i",{staticStyle:{"font-size":"10px",color:"#0d71bb"}},[t._v("("+t._s(e.daKhai?"Đã khai":"Chưa khai ")+")")]):t._e()])])]),t._v(" "),s("v-card",[s("v-card-text",[s("v-layout",{attrs:{wrap:""}},[t.stateView?t._e():s("v-flex",{staticClass:"text-xs-right",attrs:{xs12:""}},[e.hasForm?s("v-btn",{attrs:{color:"primary"},on:{click:function(s){t.saveAlpacaForm(e,i)}}},[t._v("Lưu lại")]):t._e(),t._v(" "),e.daKhai&&e.hasForm?s("v-btn",{attrs:{color:"primary"},on:{click:function(s){t.deleteSingleFileEform(e,i)}}},[t._v("Xóa")]):t._e(),t._v(" "),s("div",{attrs:{id:"formAlpaca"+e.partNo}})],1)],1)],1)],1)],1)],1),t._v(" "),s("div",{staticClass:"absolute__btn group__thanh_phan"},[t.loading?s("content-placeholders",{staticClass:"mt-1"},[s("content-placeholders-text",{attrs:{lines:1}})],1):s("v-layout",{staticClass:"flex__checkbox",attrs:{row:"",wrap:""}},[s("v-flex",{staticClass:"layout wrap",staticStyle:{width:"260px"}},[s("v-radio-group",{attrs:{row:""},on:{change:function(s){t.postDossierMark(e,i)}},model:{value:t.dossierTemplateItems[i].fileType,callback:function(e){t.$set(t.dossierTemplateItems[i],"fileType",e)},expression:"dossierTemplateItems[index].fileType"}},[s("v-radio",{attrs:{value:0}}),t._v(" "),s("v-radio",{attrs:{value:1}}),t._v(" "),s("v-radio",{attrs:{value:2}}),t._v(" "),s("v-radio",{attrs:{value:3}})],1)],1),t._v(" "),s("v-flex",{staticClass:"text-xs-center",staticStyle:{width:"110px",background:"#fff"}},[s("v-tooltip",{attrs:{top:""}},[s("v-btn",{staticClass:"mx-0 my-0",attrs:{slot:"activator",icon:""},slot:"activator"},[s("v-badge",[s("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"file"+e.partNo},on:{change:function(s){t.onUploadSingleFile(s,e)}}}),t._v(" "),s("v-icon",{attrs:{size:"16",color:"primary"},on:{click:function(s){t.pickFile(e)}}},[t._v("attach_file")])],1)],1),t._v(" "),s("span",[t._v("Tải file lên")])],1),t._v(" "),s("v-tooltip",{attrs:{top:""}},[s("v-btn",{staticClass:"mx-0",staticStyle:{height:"20px",width:"20px"},attrs:{slot:"activator",fab:"",dark:"",small:"",color:"primary"},on:{click:function(s){t.viewFileWithPartNo(e)}},slot:"activator"},[t._v("\n                "+t._s(e.count)+"\n              ")]),t._v(" "),s("span",[t._v("Xem")])],1)],1)],1)],1),t._v(" "),e.partNo===t.partView&&t.stateView?s("div",[s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",{attrs:{xs12:"",sm12:""}},t._l(t.fileViews,function(e,i){return s("div",[s("div",{staticStyle:{width:"calc(100% - 370px)",display:"flex","align-items":"center","min-height":"38px",background:"#fff","padding-left":"15px"}},[s("span",{staticClass:"ml-3",on:{click:function(s){t.viewFile2(e)}}},[t._v(t._s(e.displayName))]),t._v(" "),s("v-btn",{attrs:{icon:"",ripple:""},on:{click:function(s){t.deleteSingleFile(e,i)}}},[s("v-icon",{staticStyle:{color:"red"}},[t._v("delete_outline")])],1)],1)])}))],1)],1):t._e()],1):t._e()}),t._v(" "),s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",{attrs:{xs12:"",sm6:""}},[s("v-subheader",{staticStyle:{float:"left"}},[t._v("Thêm giấy tờ khác")])],1),t._v(" "),s("v-flex",{staticClass:"text-xs-right",attrs:{xs12:"",sm6:""}},[s("v-btn",{attrs:{color:"primary"},on:{click:function(e){t.dialogAddOtherTemp=!0}}},[s("v-icon",[t._v("add")])],1)],1)],1),t._v(" "),s("v-dialog",{attrs:{"max-width":"400",transition:"fade-transition",persistent:""},model:{value:t.dialogAddOtherTemp,callback:function(e){t.dialogAddOtherTemp=e},expression:"dialogAddOtherTemp"}},[s("v-card",[s("v-form",{ref:"form",attrs:{"lazy-validation":""},model:{value:t.valid,callback:function(e){t.valid=e},expression:"valid"}},[s("v-card-title",{staticClass:"headline"},[t._v("Thêm thành phần hồ sơ")]),t._v(" "),s("v-btn",{staticClass:"mx-0 my-0 absolute__btn_panel mr-2",attrs:{icon:"",dark:""},nativeOn:{click:function(e){t.dialogAddOtherTemp=!1}}},[s("v-icon",[t._v("clear")])],1),t._v(" "),t.loadingAddOther?s("v-progress-linear",{staticClass:"my-0",attrs:{indeterminate:!0}}):t._e(),t._v(" "),s("v-card-text",{staticClass:"pb-0 pt-4"},[s("v-layout",{attrs:{wrap:""}},[s("v-flex",{staticClass:"px-2 pb-3",attrs:{xs12:""}},[s("v-text-field",{attrs:{label:"Tên thành phần:",rules:[function(t){return!!t||"Bạn phải điền tên thành phần."}],required:""},on:{change:t.changeOtherDossierTemp},model:{value:t.otherDossierTemplate,callback:function(e){t.otherDossierTemplate=e},expression:"otherDossierTemplate"}})],1)],1)],1),t._v(" "),s("v-card-actions",[s("v-spacer"),t._v(" "),s("v-btn",{attrs:{color:"red darken-3",flat:"flat"},nativeOn:{click:function(e){t.dialogAddOtherTemp=!1}}},[t._v("\n              Quay lại\n            ")]),t._v(" "),s("v-btn",{attrs:{color:"primary",flat:"flat",loading:t.loadingAddOther},nativeOn:{click:function(e){return t.addOtherTemplate(e)}}},[t._v("\n            Đồng ý\n            "),s("span",{attrs:{slot:"loader"},slot:"loader"},[t._v("Loading...")])])],1)],1)],1)],1),t._v(" "),s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",{attrs:{xs12:"",sm8:""}},[s("v-bottom-sheet",{model:{value:t.sheet,callback:function(e){t.sheet=e},expression:"sheet"}},[s("v-list",[s("v-subheader",[t._v("Danh sách file")]),t._v(" "),t._l(t.fileViews,function(e,i){return s("v-list-tile",{key:e.dossierFileId},[s("v-list-tile-avatar"),t._v(" "),s("v-list-tile-title",[s("span",{staticStyle:{cursor:"pointer","font-weight":"bold"},on:{click:function(s){t.viewFile2(e)}}},[t._v(t._s(e.displayName))])]),t._v(" "),s("v-list-tile-action",[s("v-btn",{attrs:{icon:"",ripple:""},on:{click:function(s){t.deleteSingleFile(e,i)}}},[s("v-icon",{staticStyle:{color:"red"}},[t._v("delete_outline")])],1)],1)],1)})],2)],1)],1),t._v(" "),s("v-flex",{attrs:{xs12:"",sm4:""}})],1),t._v(" "),t._l(t.dossierTemplateItems,function(e,i){return 3===e.partType?s("div",{key:e.partNo,staticClass:"other_dossiertemplate",staticStyle:{position:"relative"}},[s("v-expansion-panel",{staticClass:"no_acction__event expaned__list__data"},[s("v-expansion-panel-content",{attrs:{"hide-actions":"",value:!1}},[s("div",{attrs:{slot:"header"},on:{click:function(e){t.stateView=!1}},slot:"header"},[s("div",{staticStyle:{width:"calc(100% - 370px)",display:"flex","align-items":"center","min-height":"38px",background:"#fff","padding-left":"15px"}},[s("span",{staticClass:"text-bold mr-2"},[t._v(t._s(i+1)+".")]),t._v(" "),s("span",[t._v(t._s(e.partName))])])]),t._v(" "),s("v-card",[s("v-card-text",[s("v-layout",{attrs:{wrap:""}},[s("v-flex",{staticClass:"text-xs-right",attrs:{xs12:""}})],1)],1)],1)],1)],1),t._v(" "),s("div",{staticClass:"absolute__btn group__thanh_phan"},[t.loading?s("content-placeholders",{staticClass:"mt-1"},[s("content-placeholders-text",{attrs:{lines:1}})],1):s("v-layout",{staticClass:"flex__checkbox",attrs:{row:"",wrap:""}},[s("v-flex",{staticClass:"layout wrap",staticStyle:{width:"260px"}},[s("v-radio-group",{attrs:{row:""},on:{change:function(s){t.postDossierMark(e,i)}},model:{value:t.dossierTemplateItems[i].fileType,callback:function(e){t.$set(t.dossierTemplateItems[i],"fileType",e)},expression:"dossierTemplateItems[index].fileType"}},[s("v-radio",{attrs:{value:0}}),t._v(" "),s("v-radio",{attrs:{value:1}}),t._v(" "),s("v-radio",{attrs:{value:2}}),t._v(" "),s("v-radio",{attrs:{value:3}})],1)],1),t._v(" "),s("v-flex",{staticStyle:{width:"110px",background:"#fff"}},[s("v-tooltip",{attrs:{top:""}},[s("v-btn",{staticClass:"mx-0 my-0",attrs:{slot:"activator",icon:""},slot:"activator"},[s("v-badge",[s("input",{staticStyle:{display:"none"},attrs:{type:"file",id:"file"+e.partNo},on:{change:function(s){t.onUploadSingleFile(s,e)}}}),t._v(" "),s("v-icon",{attrs:{size:"16",color:"primary"},on:{click:function(s){t.pickFile(e)}}},[t._v("attach_file")])],1)],1),t._v(" "),s("span",[t._v("Tải file lên")])],1),t._v(" "),s("v-tooltip",{attrs:{top:""}},[s("v-btn",{staticClass:"mx-0",staticStyle:{height:"20px",width:"20px"},attrs:{slot:"activator",fab:"",dark:"",small:"",color:"primary"},on:{click:function(s){t.viewFileWithPartNo(e)}},slot:"activator"},[t._v("\n                "+t._s(e.count)+"\n              ")]),t._v(" "),s("span",[t._v("Xem")])],1)],1)],1)],1),t._v(" "),e.partNo===t.partView&&t.stateView&&3===e.partType?s("div",[s("v-layout",{attrs:{row:"",wrap:""}},[s("v-flex",{attrs:{xs12:"",sm12:""}},t._l(t.fileViews,function(e,i){return s("div",[s("div",{staticStyle:{width:"calc(100% - 370px)",display:"flex","align-items":"center","min-height":"38px",background:"#fff","padding-left":"15px"}},[s("span",{staticClass:"ml-3",on:{click:function(s){t.viewFile2(e)}}},[t._v(t._s(e.displayName))]),t._v(" "),s("v-btn",{attrs:{icon:"",ripple:""},on:{click:function(s){t.deleteSingleFile(e,i)}}},[s("v-icon",{staticStyle:{color:"red"}},[t._v("delete_outline")])],1)],1)])}))],1)],1):t._e()],1):t._e()})],2),t._v(" "),t._m(0)],1)},staticRenderFns:[function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"absolute-lable",staticStyle:{"font-size":"12px"}},[s("span",[t._v("Không chọn")]),t._v(" "),s("span",[t._v("Bản chính")]),t._v(" "),s("span",[t._v("Bản chụp")]),t._v(" "),s("span",[t._v("Công chứng")])])}]}}});
//# sourceMappingURL=26.987827008f7375eeb8dc.js.map