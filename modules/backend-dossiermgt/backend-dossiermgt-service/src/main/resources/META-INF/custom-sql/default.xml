<?xml version="1.0" encoding="UTF-8"?>
<custom-sql>
    <sql id="org.opencps.dossiermgt.service.persistence.DossierActionFinder.findActionOverdue">
        <![CDATA[
            select userId as userId, count(*) as soluonghoso from opencps_dossieraction 
				where modifiedDate >= ? and modifiedDate <= ? and groupId=?
				and actionOverdue > 0 or (dueDate IS NOT NULL and dueDate > CURDATE())
			group by userId
        ]]>
    </sql>
    <sql id="org.opencps.dossiermgt.service.persistence.DossierActionFinder.findActionUndue">
        <![CDATA[
            select userId as userId, count(*) as soluonghoso from opencps_dossieraction 
				where modifiedDate >= ? and modifiedDate <= ? and groupId=?
				and actionOverdue = 0 or (dueDate IS NOT NULL and dueDate <= CURDATE())
			group by userId
        ]]>
    </sql>
    <sql id="org.opencps.dossiermgt.service.persistence.DossierActionFinder.findActionOverdueFuture">
        <![CDATA[
            select dau.userId, count(*) as soluonghoso from opencps_dossieraction as da1 
				inner join opencps_dossieractionuser as dau on dau.stepCode = da1.stepCode and dau.dossierActionId = da1.dossierActionId
				and modifiedDate= (select MAX(modifiedDate) from opencps_dossieraction as da2 where da1.dossierId = da2.dossierId)
				and da1.groupId=?
				and da1.dueDate > CURDATE()
			group by dau.userId;
        ]]>
    </sql>
</custom-sql>